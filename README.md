# Phase 2 L1 Calo Analyzer

## Description

   This repo is for doing one of two things:
   1. Running the emulator and creating an n-tuple for the event display,
   2. Running the emulator and creating a TTree for things like distributions, efficiency studies (to-do).

   This repo loads the emulator from the specified path and doesn't change it, but applies it fresh and then you can get the collections the emulator produces, and analyze those.

## Setup (do only once)

   On lxplus, set up `CMSSW_11_1_7` (use in conjunction with https://github.com/skkwan/cmssw/blob/devel-Phase2RCTCluster/L1Trigger/L1CaloTrigger/plugins/) and clone this repo in `CMSSW_11_1_7/src/L1Trigger/`. For instance my working area is at:
   `/afs/cern.ch/work/s/skkwan/private/phase2RCTDev/CMSSW_11_1_7/src/L1Trigger/L1CaloPhase2Analyzer/`.

   On laptop, clone this repository as well. For instance my working area is at: `/Users/stephaniekwan/Documents/Phase2L1Calo/phase2-l1Calo-analyzer`.

## To run the emulator and create an n-tuple for the event display

1. Make sure the `L1Trigger/L1CaloTrigger` area is compiled, since this analyzer loads and calls the modules from that area.

   Fun facts:
   If analyzing the CMSSW emulator, make sure the `python/` config file uses the `L1EGamma`... cluster collection.
   If analyzing the firmware-based emulator, make sure the `python/` config file uses the `Phase2L1EGamma`... cluster collection.
(Otherwise the clusters won't show up)

2. To make a EVENT DISPLAY n-tuple:
   ```
   cmsenv
   cd test/
   cmsRun test-l1t-cmssw-EventDisplayGenerator.py
   ```

   To call the firmware-based emulator and make an n-tuple from that,
   ```
   cmsenv
   cmsRun test-l1tEventDisplayGenerator.py   
   ```

3. The firmware-based (original CMSSW) emulator creates these outputs: 
    * `L1EventDisplay.root` (`L1EventDisplay-cmssw.root`) - this should be used in the event display code
    * `.txt` printouts specified in the `L1Trigger/L1CaloTrigger` plugins scripts) - helpful for info/debugging
    * `phase2L1CaloEGamma.root` (`cmsswCaloEGamma.root`): the outputs generated by the `L1Trigger/L1CaloTrigger` plugins scripts) - can ignore

4. Copy the `L1EventDisplay` ROOT files into the event display repo: https://github.com/skkwan/phase2-l1t-eventDisplay and proceed there

## To run the emulator and create a TTree for distributions, efficiencies, etc.

1. Same as step 1 above.

2. To make an EFFICIENCYTREE n-tuple:
   ```
   cmsenv
   cd test/
   cmsRun test-analyzer.py
   ```
   This produces `analyzer.root`.

3. (Important) `scp` the file to somewhere on the laptop working area, and check that `runDistribPlots.sh` points to the right input file, and check that `runDistributionPlots.C` points to a valid output directory to write the .pngs and .pdfs.

4. Then run the analyzer (only ROOT needed):
   ```
   # On laptop working area
   cd figures/validationPlots
   source runDistribPlots.sh    # if you get weird ROOT errors make sure there are no mismatched brackets }
   ```
   There should be printout statements saying where the .pngs and .pdfs were written.
